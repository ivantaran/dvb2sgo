package dvb2s

import "math"

const bchPolyNLength int = 17 // TODO: N - Normal frame, change const name
const ldpcBlockSize int = 360
const slotSize int = 90

var map1Pi4 = 0.5 * math.Sqrt(2.0)

var (
	fecFramesizeMap = map[string]int{
		"normal": 64800,
		"small":  16200,
	}

	plHeaderSof = []bool{
		false, true, true, false, false, false, true, true,
		false, true, false, false, true, false, true, true,
		true, false, true, false, false, false, false, false,
		true, false,
	}

	plHeaderScrambleTable = []bool{
		false, true, true, true, false, false, false, true,
		true, false, false, true, true, true, false, true,
		true, false, false, false, false, false, true, true,
		true, true, false, false, true, false, false, true,
		false, true, false, true, false, false, true, true,
		false, true, false, false, false, false, true, false,
		false, false, true, false, true, true, false, true,
		true, true, true, true, true, false, true, false,
	}

	plHeaderGTable = []int{
		0x90ac2ddd,
		0x55555555,
		0x33333333,
		0x0f0f0f0f,
		0x00ff00ff,
		0x0000ffff,
		0xffffffff,
	}

	bchPolyN = [][bchPolyNLength]bool{ //TODO: replace [bchPolyNLength] to []
		{true, false, true, true, false, true, false, false, false, false, false, false, false, false, false, false, true},
		{true, true, false, false, true, true, true, false, true, false, false, false, false, false, false, false, true},
		{true, false, true, true, true, true, false, true, true, true, true, true, false, false, false, false, true},
		{true, false, true, false, true, false, true, false, false, true, false, true, true, false, true, false, true},
		{true, true, true, true, false, true, false, false, true, true, true, true, true, false, false, false, true},
		{true, false, true, false, true, true, false, true, true, true, true, false, true, true, true, true, true},
		{true, false, true, false, false, true, true, false, true, true, true, true, false, true, false, true, true},
		{true, true, true, false, false, true, true, false, true, true, false, false, true, true, true, false, true},
		{true, false, false, false, false, true, false, true, false, true, true, true, false, false, false, false, true},
		{true, true, true, false, false, true, false, true, true, false, true, false, true, true, true, false, true},
		{true, false, true, true, false, true, false, false, false, true, false, true, true, true, false, false, true},
		{true, true, false, false, false, true, true, true, false, true, false, true, true, false, false, false, true},
	}

	ldpcTable3_4 = [][]int16{
		{0, 6385, 7901, 14611, 13389, 11200, 3252, 5243, 2504, 2722, 821, 7374},
		{1, 11359, 2698, 357, 13824, 12772, 7244, 6752, 15310, 852, 2001, 11417},
		{2, 7862, 7977, 6321, 13612, 12197, 14449, 15137, 13860, 1708, 6399, 13444},
		{3, 1560, 11804, 6975, 13292, 3646, 3812, 8772, 7306, 5795, 14327, 7866},
		{4, 7626, 11407, 14599, 9689, 1628, 2113, 10809, 9283, 1230, 15241, 4870},
		{5, 1610, 5699, 15876, 9446, 12515, 1400, 6303, 5411, 14181, 13925, 7358},
		{6, 4059, 8836, 3405, 7853, 7992, 15336, 5970, 10368, 10278, 9675, 4651},
		{7, 4441, 3963, 9153, 2109, 12683, 7459, 12030, 12221, 629, 15212, 406},
		{8, 6007, 8411, 5771, 3497, 543, 14202, 875, 9186, 6235, 13908, 3563},
		{9, 3232, 6625, 4795, 546, 9781, 2071, 7312, 3399, 7250, 4932, 12652},
		{10, 8820, 10088, 11090, 7069, 6585, 13134, 10158, 7183, 488, 7455, 9238},
		{11, 1903, 10818, 119, 215, 7558, 11046, 10615, 11545, 14784, 7961, 15619},
		{12, 3655, 8736, 4917, 15874, 5129, 2134, 15944, 14768, 7150, 2692, 1469},
		{13, 8316, 3820, 505, 8923, 6757, 806, 7957, 4216, 15589, 13244, 2622},
		{14, 14463, 4852, 15733, 3041, 11193, 12860, 13673, 8152, 6551, 15108, 8758},
		{15, 3149, 11981},
		{16, 13416, 6906},
		{17, 13098, 13352},
		{18, 2009, 14460},
		{19, 7207, 4314},
		{20, 3312, 3945},
		{21, 4418, 6248},
		{22, 2669, 13975},
		{23, 7571, 9023},
		{24, 14172, 2967},
		{25, 7271, 7138},
		{26, 6135, 13670},
		{27, 7490, 14559},
		{28, 8657, 2466},
		{29, 8599, 12834},
		{30, 3470, 3152},
		{31, 13917, 4365},
		{32, 6024, 13730},
		{33, 10973, 14182},
		{34, 2464, 13167},
		{35, 5281, 15049},
		{36, 1103, 1849},
		{37, 2058, 1069},
		{38, 9654, 6095},
		{39, 14311, 7667},
		{40, 15617, 8146},
		{41, 4588, 11218},
		{42, 13660, 6243},
		{43, 8578, 7874},
		{44, 11741, 2686},
		{0, 1022, 1264},
		{1, 12604, 9965},
		{2, 8217, 2707},
		{3, 3156, 11793},
		{4, 354, 1514},
		{5, 6978, 14058},
		{6, 7922, 16079},
		{7, 15087, 12138},
		{8, 5053, 6470},
		{9, 12687, 14932},
		{10, 15458, 1763},
		{11, 8121, 1721},
		{12, 12431, 549},
		{13, 4129, 7091},
		{14, 1426, 8415},
		{15, 9783, 7604},
		{16, 6295, 11329},
		{17, 1409, 12061},
		{18, 8065, 9087},
		{19, 2918, 8438},
		{20, 1293, 14115},
		{21, 3922, 13851},
		{22, 3851, 4000},
		{23, 5865, 1768},
		{24, 2655, 14957},
		{25, 5565, 6332},
		{26, 4303, 12631},
		{27, 11653, 12236},
		{28, 16025, 7632},
		{29, 4655, 14128},
		{30, 9584, 13123},
		{31, 13987, 9597},
		{32, 15409, 12110},
		{33, 8754, 15490},
		{34, 7416, 15325},
		{35, 2909, 15549},
		{36, 2995, 8257},
		{37, 9406, 4791},
		{38, 11111, 4854},
		{39, 2812, 8521},
		{40, 8476, 14717},
		{41, 7820, 15360},
		{42, 1179, 7939},
		{43, 2357, 8678},
		{44, 7703, 6216},
		{0, 3477, 7067},
		{1, 3931, 13845},
		{2, 7675, 12899},
		{3, 1754, 8187},
		{4, 7785, 1400},
		{5, 9213, 5891},
		{6, 2494, 7703},
		{7, 2576, 7902},
		{8, 4821, 15682},
		{9, 10426, 11935},
		{10, 1810, 904},
		{11, 11332, 9264},
		{12, 11312, 3570},
		{13, 14916, 2650},
		{14, 7679, 7842},
		{15, 6089, 13084},
		{16, 3938, 2751},
		{17, 8509, 4648},
		{18, 12204, 8917},
		{19, 5749, 12443},
		{20, 12613, 4431},
		{21, 1344, 4014},
		{22, 8488, 13850},
		{23, 1730, 14896},
		{24, 14942, 7126},
		{25, 14983, 8863},
		{26, 6578, 8564},
		{27, 4947, 396},
		{28, 297, 12805},
		{29, 13878, 6692},
		{30, 11857, 11186},
		{31, 14395, 11493},
		{32, 16145, 12251},
		{33, 13462, 7428},
		{34, 14526, 13119},
		{35, 2535, 11243},
		{36, 6465, 12690},
		{37, 6872, 9334},
		{38, 15371, 14023},
		{39, 8101, 10187},
		{40, 11963, 4848},
		{41, 15125, 6119},
		{42, 8051, 14465},
		{43, 11139, 5167},
		{44, 2883, 14521},
	}

	firRrc2x035Table = []float64{
		+0.002850832394,
		-0.001580242052,
		-0.000944046661,
		+0.002647343726,
		-0.002918984973,
		+0.000621487209,
		+0.004366994481,
		-0.005732140790,
		+0.000603620941,
		+0.005143836254,
		-0.012803164874,
		+0.012546412009,
		+0.028807332622,
		-0.067591938242,
		-0.042396478242,
		+0.303945241884,
		+0.547718621021,
		+0.303945241884,
		-0.042396478242,
		-0.067591938242,
		+0.028807332622,
		+0.012546412009,
		-0.012803164874,
		+0.005143836254,
		+0.000603620941,
		-0.005732140790,
		+0.004366994481,
		+0.000621487209,
		-0.002918984973,
		+0.002647343726,
		-0.000944046661,
		-0.001580242052,
	}

	firRrc4x035Table = []float64{
		+0.000603620941,
		+0.000552831988,
		-0.000294152268,
		-0.002521370188,
		-0.004218085197,
		-0.001591900020,
		+0.006583949609,
		+0.014853229883,
		+0.012944173824,
		-0.005338171447,
		-0.032472297258,
		-0.046243529025,
		-0.021670262452,
		+0.050356799233,
		+0.151182499916,
		+0.239932109576,
		+0.275284726708,
		+0.239932109576,
		+0.151182499916,
		+0.050356799233,
		-0.021670262452,
		-0.046243529025,
		-0.032472297258,
		-0.005338171447,
		+0.012944173824,
		+0.014853229883,
		+0.006583949609,
		-0.001591900020,
		-0.004218085197,
		-0.002521370188,
		-0.000294152268,
		+0.000552831988,
	}

	firRrc2x035BigTable = []float64{
		+0.000161369138,
		-0.000084084574,
		-0.000081513705,
		+0.000169193910,
		-0.000081394065,
		-0.000084662256,
		+0.000168242252,
		-0.000090763847,
		-0.000087705188,
		+0.000182890581,
		-0.000090067162,
		-0.000089703904,
		+0.000189752729,
		-0.000108456344,
		-0.000097914588,
		+0.000211981027,
		-0.000111717943,
		-0.000096554506,
		+0.000228915917,
		-0.000143085762,
		-0.000110171722,
		+0.000260484861,
		-0.000153483689,
		-0.000101748853,
		+0.000292148571,
		-0.000205114624,
		-0.000121869921,
		+0.000336437615,
		-0.000228731898,
		-0.000099193954,
		+0.000392557659,
		-0.000315069899,
		-0.000128314568,
		+0.000456086324,
		-0.000365314434,
		-0.000075397377,
		+0.000558799786,
		-0.000518491742,
		-0.000118800092,
		+0.000655254116,
		-0.000629940152,
		+0.000006215804,
		+0.000863097254,
		-0.000934748488,
		-0.000063472673,
		+0.001026002257,
		-0.001218303101,
		+0.000272519336,
		+0.001537134140,
		-0.001968187909,
		+0.000143255112,
		+0.001872883575,
		-0.002935093308,
		+0.001385454741,
		+0.003747448078,
		-0.005819498321,
		+0.001029117709,
		+0.004784460610,
		-0.012730737112,
		+0.012813128392,
		+0.028558658799,
		-0.067586540821,
		-0.042342207763,
		+0.303888310033,
		+0.547813881018,
		+0.303888310033,
		-0.042342207763,
		-0.067586540821,
		+0.028558658799,
		+0.012813128392,
		-0.012730737112,
		+0.004784460610,
		+0.001029117709,
		-0.005819498321,
		+0.003747448078,
		+0.001385454741,
		-0.002935093308,
		+0.001872883575,
		+0.000143255112,
		-0.001968187909,
		+0.001537134140,
		+0.000272519336,
		-0.001218303101,
		+0.001026002257,
		-0.000063472673,
		-0.000934748488,
		+0.000863097254,
		+0.000006215804,
		-0.000629940152,
		+0.000655254116,
		-0.000118800092,
		-0.000518491742,
		+0.000558799786,
		-0.000075397377,
		-0.000365314434,
		+0.000456086324,
		-0.000128314568,
		-0.000315069899,
		+0.000392557659,
		-0.000099193954,
		-0.000228731898,
		+0.000336437615,
		-0.000121869921,
		-0.000205114624,
		+0.000292148571,
		-0.000101748853,
		-0.000153483689,
		+0.000260484861,
		-0.000110171722,
		-0.000143085762,
		+0.000228915917,
		-0.000096554506,
		-0.000111717943,
		+0.000211981027,
		-0.000097914588,
		-0.000108456344,
		+0.000189752729,
		-0.000089703904,
		-0.000090067162,
		+0.000182890581,
		-0.000087705188,
		-0.000090763847,
		+0.000168242252,
		-0.000084662256,
		-0.000081394065,
		+0.000169193910,
		-0.000081513705,
		-0.000084084574,
	}
)
